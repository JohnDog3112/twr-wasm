<!doctype html>
<head>
	<title>tiny-was-runtime Bouncing Balls Demonstration</title>
</head>
<body style="background-color:white;font-family: Arial">
	<div id="top">
		<h1>Bouncing Balls</h1>
		<h2>tiny-wasm-runtime</h2>
		<ul>
			<li>written in C++</li>
			<li>using 2D draw APIs which correspond to Javascript Canvas APIs</li>
			<li>source code: <a href="https://github.com/twiddlingbits/tiny-wasm-runtime/tree/main/examples/balls">here on github</a></li>
		</ul>	
		<br>
	</div>
	
	<canvas id="twr_d2dcanvas" style="background-color:white"></canvas>

	<!-- this is used when executing code without bundling -->
	<script type="importmap">
	{
		"imports": {
		"tiny-wasm-runtime": "../../lib-js/index.js",
		"whatkey": "../../lib-js/whatkey.js"
		}
	}
	</script>

	<script type="module">
		import {twrWasmModule} from "tiny-wasm-runtime";

		const canvas = document.getElementById("twr_d2dcanvas");
		const top = document.getElementById("top");
		let width=top.clientWidth-20;
		let height=window.innerHeight-top.clientHeight-40;

		if (width>1000) width=1000;
		if (width<150) width=150;
		if (height>1000) height=1000;
		if (height<150) height=150;

		canvas.setAttribute("width", width);
		canvas.setAttribute("height", height);

		const tickTimeMs=8;  	// ~ 120 fps
		const slowMow=1;  		// use larger number to pause between display updates
		const ballSpeed=0.3		// pixels per millisecond

		const mod=new twrWasmModule();
		await mod.loadWasm('balls.wasm');
		await mod.executeC(["bounce_balls_init", ballSpeed]);
		const timer = setInterval(async ()=>{
			let r=await mod.executeC(["bounce_balls_move", tickTimeMs]);  
		}, tickTimeMs*slowMow);
	</script>
</body>
</html>
 