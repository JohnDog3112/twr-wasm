<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://twiddlingbits.dev/docsite/gettingstarted/keyconcepts/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Key Concepts - twr-wasm - Easy C/C++ Web Assembly Modules</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Key Concepts";
        var mkdocs_page_input_path = "gettingstarted\\keyconcepts.md";
        var mkdocs_page_url = "/docsite/gettingstarted/keyconcepts/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> twr-wasm - Easy C/C++ Web Assembly Modules
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../helloworld/">Create wasm C Hello World</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Key Concepts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stdio/">Stdio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compiler-opts/">Compiler, Linker, Memory</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">WASM Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-helloworld/">hello world</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-div/">stdio-div</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-canvas/">stdio-canvas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-balls/">balls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-maze/">maze</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-fft/">fft</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-libcxx/">libc++</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-more/">more</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">twr-wasm API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-typescript/">TypeScript/JavaScript</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-localization/">C Localization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-c-general/">C General</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-libc%2B%2B/">C++ with libc++</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-c-d2d/">C Draw 2D</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-c-con/">C Console I/O</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/api-c-stdlib/">C Standard C Library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">More</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/wasm-problem/">WASM Runtime Limitations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/debugging/">Debugging WASM</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/production/">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/building/">Building the Source</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">twr-wasm - Easy C/C++ Web Assembly Modules</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Getting Started</li>
      <li class="breadcrumb-item active">Key Concepts</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/twiddlingbits/twr-wasm/tree/main/docs/gettingstarted/keyconcepts.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1>Key Concepts - C/C++ WASM</h1>
<p>This section describes some key concepts that apply when using twr-wasm with your C/C++ Web Assembly code.</p>
<h2>Overview</h2>

<p>Your C/C++ Web Assembly project will consist of HTML (and related JavaScript or Typescript) and C or C++ source files that are compiled into a ".wasm" binary file that is loaded as a Web Assembly module by your JavaScript or HTML.</p>
<p>You will call C functions (or C++ with ' extern "C" ' linkage) in the .wasm module from your JavaScript.  You can also call JavaScript functions from your C/C++ code, but this is less common.</p>
<p>There is no direct equivalent to a C "main".  Instead, a wasm module provides exported C functions that you can call from JavaScript/TypeScript.  A wasm module is more like a runtime loaded dynamic library.</p>
<p>On the JavaScript side you will use the twr-wasm JavaScript/TypeScript class <code>twrWasmModule</code> or <code>twrWasmModuleAsync</code> to load the .wasm module, and then call C functions in it (more details are in the <a href="../../api/api-typescript/">TypeScript/Javascript API section</a>).</p>
<p>You're C/C++ code can be non-blocking or blocking.  Blocking means that it "takes a long time" to return.   For example, if you want to send mouse events to C code, have the code process them then return, this would be non-blocking.  Alternately, if your C code is a big loop that never returns, that would be very blocking.   You can use the twr-wasm class <code>twrWasmModuleAsync</code> to execute blocking code from JavaScript.  The example <a href="../../examples/examples-maze/">maze</a> demonstrates both non-blocking and blocking C calls.</p>
<p>Here are some examples of different types of C/C++ code:</p>
<ul>
<li>If you're C/C++ code does not have any direct user interface built in, it can do its calculations and return.  The <a href="../../examples/examples-fft/">FFT</a> is an example of this.  </li>
<li>If your C/C++ code uses a classic C "UI", where it gets keys from stdin and sends the results to stdout, you can direct stdin and stdout to a <code>&lt;div&gt;</code> or <code>&lt;canvas&gt;</code> tag.  This is explained in the <a href="../stdio/">stdio</a> section.</li>
<li>Your C/C++ code could be sent events from JavaScript (such mouse, key, timer, or other). This is done by simply calling a C function with the events as parameters.  The C/C++ code could then generate no output, could render to a <code>&lt;div&gt;</code> or <code>&lt;canvas&gt;</code> using stdio type C/C++ functions, or it could render to a <code>&lt;canvas&gt;</code> using 2D drawing APIs that correspond to JavaScript canvas 2D draw operations.  (<a href="../../examples/examples-balls/">Balls</a>) is an example.</li>
</ul>
<h2>Steps to integrate C code with JavaScript code</h2>

<p>Here are the general steps to integrate your C with your JavaScript:</p>
<ol>
<li><a href="../compiler-opts/">Compile your C code</a> with clang and link with wasm-ld to create the <code>.wasm</code> file.</li>
<li>On the JavaScript side you:<ol>
<li>Access twr-wasm "ES" modules in the normal way with <code>import</code>. </li>
<li>Add a <code>&lt;div id=twr_iodiv&gt;</code> or <code>&lt;canvas id=twr_iocanvas&gt;</code> to your HTML (<a href="../stdio/">see stdio</a>)</li>
<li>Use <code>new twrWasmModule()</code>, followed by a call to <code>loadWasm()</code>, then one or more <code>callC()</code>.</li>
<li>Alternately, use <code>twrWasmModuleAsync()</code> -- which is interchangeable with twrWasmModule, but proxies through a worker thread, and adds blocking support, including blocking char input.</li>
</ol>
</li>
</ol>
<h2>Passing strings, arrayBuffers, etc</h2>
<p>The Web Assembly runtime provided in a browser will only pass numbers between C functions and JavaScript functions.  This means if you use <code>twrWasmModule.callC</code> to call a C function, and pass integers or floats as arguments, they will work as expected.  But if you pass a string,  arrayBuffer, or the contents or a URL, <code>twrWasmModule.callC</code> will:</p>
<ul>
<li>allocate memory in your WebAssembly.Memory (using malloc).</li>
<li>copy the string (or  arrayBuffer or URL contents) into this memory.</li>
<li>pass the memory index (aka a pointer in C land) to your C code. </li>
<li>If URL contents are passed, your C function will receive a pointer to the data as the first argument, and a length as the second argument.</li>
<li>If an arrayBuffer is passed to your C/C++ code, you probably will also need to pass in the length (unless it is already known).</li>
<li>Upon return, the malloced memory is freed, and if the argument was an arrayBuffer, the appropriate contents in the wasm module memory are copied back into the arrayBuffer.   This means that if your C code modifies a passed in block of arrayBuffer memory, the results will be reflected back into javaScript land. </li>
</ul>
<p>Some module functions (such as <code>getString</code>) take or return an "index:number".  Here index means an index into WebAssembly.Memory.  As far as your C code is concerned, this is a pointer.</p>
<p>Recalled that an arrayBuffer can be created and accessed using classes like <code>Uint8Array</code> or <code>Float32Array</code>.</p>
<p>It is helpful to look at the <a href="../../examples/examples-overview/">examples</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../helloworld/" class="btn btn-neutral float-left" title="Create wasm C Hello World"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../stdio/" class="btn btn-neutral float-right" title="Stdio">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/twiddlingbits/twr-wasm" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../helloworld/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../stdio/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
