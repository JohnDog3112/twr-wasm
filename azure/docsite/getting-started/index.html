<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://twiddlingbits.dev/getting-started/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Getting Started - tiny-wasm-runtime documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Getting Started";
        var mkdocs_page_input_path = "getting-started.md";
        var mkdocs_page_url = "/getting-started/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> tiny-wasm-runtime documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Getting Started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-your-first-web-assembly-program">Creating Your First Web Assembly Program</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-1-create-the-c-code">step 1: Create the C code</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-2-create-the-html">step 2: create the HTML</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-3-compile-your-c-code-to-create-your-wasm-file">step 3: compile your C code to create your .wasm file</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-4-run-your-program">step 4: run your program</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#vs-code-launchjson">VS Code launch.json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#run-a-local-web-server">Run a local web Server</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#see-live-version">See live version</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#next-steps-after-hello-world">Next steps after hello world</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#overview-of-steps-to-integrate-your-c-code-with-your-javascript-code">Overview of steps to integrate your C code with your JavaScript code</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passing-strings-arraybuffers-etc">Passing strings, arrayBuffers, etc</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stdio/">Stdio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compiler-opts/">Compiler, Linker, Memory</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-helloworld/">hello world</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-stdio-div/">stdio-div</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-stdio-canvas/">stdio-canvas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-balls/">balls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-maze/">maze</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-fft/">fft</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples-more/">more</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api-typescript/">TypeScript/JavaScript</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-general/">C General</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-d2d/">C Draw 2D</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-con/">C Console I/O</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-stdlib/">C Stdlib</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">More</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../wasm-problem/">The Wasm Problem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../production/">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../building/">Building the Source</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">tiny-wasm-runtime documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Getting Started</li>
      <li class="breadcrumb-item active">Getting Started</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/twiddlingbits/tiny-wasm-runtime/tree/main/docs/getting-started.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="getting-started">Getting Started</h1>
<h2 id="installation">Installation</h2>
<pre><code> git clone https://github.com/twiddlingbits/tiny-wasm-runtime
</code></pre>
<p>or</p>
<pre><code>   npm install tiny-wasm-runtime
</code></pre>
<ul>
<li><code>git clone</code> will copy the built libraries (lib-js, lib-c) as well as the source, examples, docs and VS Code settings.</li>
<li><code>npm install</code> will copy the minimum necessary to build your software: built libraries (lib-js, lib-c) and the examples.</li>
</ul>
<p>Either will work.</p>
<p><strong>Installs for your C/C++ code</strong></p>
<p>To build C/C++ code for use in your wasm project, you will need to install clang and the wasm-ld linker.  If you are using Windows, more details can be found at <a href="../building/">the end of the Building Source section.</a></p>
<h2 id="creating-your-first-web-assembly-program">Creating Your First Web Assembly Program</h2>
<p>You can find all of the code for this section in the folder <a href="https://github.com/twiddlingbits/tiny-wasm-runtime/tree/main/examples/helloworld"><code>examples\helloworld</code></a>.</p>
<h3 id="step-1-create-the-c-code">step 1: Create the C code</h3>
<p>Create a file <code>helloworld.c</code></p>
<pre><code>#include &lt;stdio.h&gt;

void hello() {
    printf(&quot;hello world\n&quot;);
}
</code></pre>
<h3 id="step-2-create-the-html">step 2: create the HTML</h3>
<p>Create a file <code>index.html</code></p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Hello World&lt;/title&gt;

    &lt;script type=&quot;importmap&quot;&gt;
    {
        &quot;imports&quot;: {
        &quot;tiny-wasm-runtime&quot;: &quot;../../lib-js/index.js&quot;,
        &quot;whatkey&quot;: &quot;../../lib-js/whatkey.js&quot;
        }
    }
    &lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;twr_iodiv&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;module&quot;&gt;
        import {twrWasmModule} from &quot;tiny-wasm-runtime&quot;;

        const mod = new twrWasmModule();
        await mod.loadWasm(&quot;./helloworld.wasm&quot;);
        await mod.callC([&quot;hello&quot;]);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The two relative paths in the importmap section need to be updated to point to the location where you installed <code>tiny-wasm-runtime/lib-js</code>.  The paths above are correct if your file is in an <code>example</code> subfolder.</p>
<h3 id="step-3-compile-your-c-code-to-create-your-wasm-file">step 3: compile your C code to create your .wasm file</h3>
<pre><code>clang --target=wasm32 -fno-exceptions -nostdinc -nostdlib -isystem ../../include -c -Wall  helloworld.c -o helloworld.o
wasm-ld  helloworld.o ../../lib-c/twr.a -o helloworld.wasm  --no-entry  --initial-memory=131072 --max-memory=131072 --export=hello 
</code></pre>
<p>The path to <code>twa.a</code> and to <code>include</code>  may need to be updated.  The above path is correct if your code is in an <code>example</code> subfolder.</p>
<h3 id="step-4-run-your-program">step 4: run your program</h3>
<p>The two easiest ways to run your <code>index.html</code> web page locally are:</p>
<h4 id="vs-code-launchjson">VS Code launch.json</h4>
<p>Add an entry similar to this to your <code>launch.json</code>.  Adjust the <code>file</code> and <code>cwd</code> lines to be correct for your project.</p>
<pre><code>        {
            &quot;name&quot;: &quot;hello&quot;,
            &quot;type&quot;: &quot;chrome&quot;,
            &quot;request&quot;: &quot;launch&quot;,
            &quot;runtimeArgs&quot;: [
                &quot;--allow-file-access-from-files&quot;,
                &quot;--autoplay-policy=no-user-gesture-required&quot;,
                &quot;--enable-features=SharedArrayBuffer&quot;
            ],
            &quot;file&quot;: &quot;${workspaceFolder}/examples/index.html&quot;,
            &quot;cwd&quot;: &quot;${workspaceFolder}/examples/&quot;
        }
</code></pre>
<h4 id="run-a-local-web-server">Run a local web Server</h4>
<p>Alternately, you can run a local server.  <code>python server.py</code> will work if you copy the <code>server.py</code> file from the examples folder to your project folder.</p>
<h3 id="see-live-version">See live version</h3>
<p>Here is a link to the helloworld function running: <a href="/examples/helloworld/index.html">/examples/helloworld/index.html</a></p>
<h2 id="next-steps-after-hello-world">Next steps after hello world</h2>
<p>A good way to get your own code up and running is to copy one of the <code>tiny-wasm-runtime/examples</code>, get it to build and run, then start modifying it.  </p>
<p>The example makefiles proved a more practical way to configure clang and wasm-ld (the linker).</p>
<p>Hello World uses the tiny-wasm-runtime class <code>twrWasmModule</code>.   If you wish to use C blocking functions, such as <code>twr_getchar</code> or <code>twr_wasm_sleep</code>, you can use <code>twrWasmModuleAsync</code>.  For example, this square calculator shows how to do this:  <a href="/examples/stdio-div/index.html">live demo</a> or <a href="https://github.com/twiddlingbits/tiny-wasm-runtime/tree/main/examples/stdio-div">Source</a>.</p>
<h2 id="overview-of-steps-to-integrate-your-c-code-with-your-javascript-code">Overview of steps to integrate your C code with your JavaScript code</h2>
<p>Here are the general steps to integrate your C with Javascript:</p>
<ol>
<li>Compile your C code with clang to create the <code>.wasm</code> file.</li>
<li>On the JavaScript side you:<ol>
<li>access tiny-wasm-runtime "ES" modules in the normal way with "import". </li>
<li>add a <code>&lt;div&gt;</code> named <code>twr_iodiv</code> to your HTML (there are other options, this is the simplest)</li>
<li>use <code>new twrWasmModule()</code>, followed by <code>loadWasm()</code>, then <code>callC()</code>.</li>
<li>Alternately, use <code>twrWasmModuleAsync()</code> -- it is interchangeable with twrWasmModule, but proxies through a worker thread, and adds blocking support, including blocking char input</li>
</ol>
</li>
</ol>
<h2 id="passing-strings-arraybuffers-etc">Passing strings, arrayBuffers, etc</h2>
<p>The Web Assembly runtime provided in a browser will only pass numbers between C functions and Javascript functions.  This means if you use <code>twrWasmModule.callC</code> to call a C function, and pass integers or floats as arguments, they will work as expected.  But if you pass a string,  arrayBuffer, or the contents or a URL, <code>twrWasmModule.callC</code> will: <br />
-  allocate memory in your WebAssembly.Memory (using twr_malloc)
-  copy the string (or  arrayBuffer or URL contents) into this memory, 
-  and pass the memory index (aka a pointer in C land) to your C code. 
-  If URL contents are passed, your C function will receive a pointer to the data as the first argument, and a length as the second argument.
-  If an arrayBuffer is passed to your C/C++ code, you probably will also need to pass in the length (unless it is already known).
-  Upon return, the malloced memory is freed, and if the argument was an arrayBuffer, the appropriate contents in the wasm moudle memory are copied back into the arrayBuffer.   This means that if your C code modifies a passed in block of memory, the results will be reflected back into javascript land. </p>
<p>Some module functions (such as <code>getString</code>) take or return an "index:number".  Here index means an index into WebAssembly.Memory.  As far as your C code is concerned, this is a pointer.</p>
<p>Recalled that an arrayBuffer can be created and accessed using classes like <code>Uint8Array</code> or <code>Float32Array</code>.</p>
<p>See the examples "function-calls" and fft.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../stdio/" class="btn btn-neutral float-right" title="Stdio">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/twiddlingbits/tiny-wasm-runtime" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../stdio/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
