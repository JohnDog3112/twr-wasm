<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://twiddlingbits.dev/api/api-c-general/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>C General - tiny-wasm-runtime documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "C General";
        var mkdocs_page_input_path = "api\\api-c-general.md";
        var mkdocs_page_url = "/api/api-c-general/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> tiny-wasm-runtime documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/firstwasm/">Your First C Wasm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/keyconcepts/">Key Concepts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/stdio/">Stdio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/compiler-opts/">Compiler, Linker, Memory</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-helloworld/">hello world</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-div/">stdio-div</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-canvas/">stdio-canvas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-balls/">balls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-maze/">maze</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-fft/">fft</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-more/">more</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api-typescript/">TypeScript/JavaScript</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">C General</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_getchar">twr_getchar</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_gets">twr_gets</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_conlog">twr_conlog</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_wasm_sleep">twr_wasm_sleep</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_wasm_tofixed">twr_wasm_tofixed</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_wasm_toexponential">twr_wasm_toexponential</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_dtoa">twr_dtoa</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_atod">twr_atod</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_atou64">twr_atou64</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#floating-math-helpers">floating math helpers</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_cache_mallocfree">twr_cache_malloc/free</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_atosign">twr_atosign</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_strhorizflip">twr_strhorizflip</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#twr_vprintf">twr_vprintf</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-d2d/">C Draw 2D</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-con/">C Console I/O</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-stdlib/">C Stdlib</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">More</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/wasm-problem/">The Wasm Problem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/production/">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/building/">Building the Source</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">tiny-wasm-runtime documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
      <li class="breadcrumb-item active">C General</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/twiddlingbits/tiny-wasm-runtime/tree/main/docs/api/api-c-general.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="c-api-general">C API - General</h1>
<h2 id="overview">Overview</h2>
<p><code>lib-c/twr.a</code> is the tiny-wasm-runtime static library that provides C APIs your C/C++ code can use.  C APIs fall into these catagories:</p>
<ul>
<li><a href="../api-c-stdlib/">A subset of stdlib</a>, like printf and strcpy</li>
<li>General functions, like <code>twr_wasm_sleep</code> and <code>twr_getchar</code></li>
<li>Draw 2D APIs compatible with JavasScript Canvas</li>
<li>Console I/O for streamed (tty) or terminal I/O</li>
</ul>
<p>C API header files will be in one of these two include files:</p>
<ul>
<li><code>\tiny-wasm-runtime\include\twr-crt.h</code></li>
<li><code>\tiny-wasm-runtime\include\twr-wasm.h</code></li>
</ul>
<h2 id="twr_getchar">twr_getchar</h2>
<p>Gets a character from <a href="../../gettingstarted/stdio/">stdin</a></p>
<pre><code>#include &quot;twr-crt.h&quot;

int twr_getchar();
</code></pre>
<p>Internally this function calls the <a href="../../gettingstarted/stdio/">stdio</a> IoConsole -- see the IoConsole section for more advanced input/output.</p>
<h2 id="twr_gets">twr_gets</h2>
<p>Gets a string from <a href="../../gettingstarted/stdio/">stdin</a> </p>
<pre><code>#include &quot;twr-crt.h&quot;

char* twr_gets(char* buffer);
</code></pre>
<p>Internally this function calls the <a href="../../gettingstarted/stdio/">stdio</a> IoConsole -- see the IoConsole section for more advanced input/output.</p>
<h2 id="twr_conlog">twr_conlog</h2>
<p><code>twr_conlog</code> prints debug messages to the browser console from your C code.</p>
<pre><code>#include &quot;twr-crt.h&quot;

void twr_conlog(char* format, ...);
</code></pre>
<p>Each call to twr_conlog() will generate a single call to console.log() in JavaScript to ensure that you see debug prints.  This call is identical to printf, except that it adds a newline.</p>
<p>The current implementation does not wait for the debug string to output to the console before returning from twr_conlog, when using twrWasmModuleAsync.  In this case, it can take a small bit of time for the string to make its way across the Worker Thread boundary.  This is normally not a problem and results in faster performance.  But if your code crashes soon after the debug print, the print might not appear.  If you think this is an issue, you can call <code>twr_wasm_sleep(1)</code> after your twr_conlog call.  This will force a blocking wait for the print to print.</p>
<p>Prior to 1.0, this function was called <code>twr_dbg_printf</code>, and operated slightly differently.</p>
<h2 id="twr_wasm_sleep">twr_wasm_sleep</h2>
<p><code>twr_wasm_sleep</code> is a traditional blocking sleep function:</p>
<pre><code>#include &quot;twr-wasm.h&quot;

void twr_wasm_sleep(int ms);
</code></pre>
<h2 id="twr_wasm_tofixed">twr_wasm_tofixed</h2>
<p>This function is identical to its Javascript version.</p>
<pre><code>#include &quot;twr-wasm.h&quot;

void twr_wasm_tofixed(char* buffer, int buffer_size, double value, int dec_digits);
</code></pre>
<p>The functions to convert double to text are <code>snprintf</code>, <code>fcvt_s</code>,<code>twr_dtoa</code>, <code>twr_wasm_toexponential</code>, and <code>twr_wasm_tofixed</code></p>
<h2 id="twr_wasm_toexponential">twr_wasm_toexponential</h2>
<p>This function is identical to its Javascript version.</p>
<pre><code>#include &quot;twr-wasm.h&quot;

void twr_wasm_toexponential(char* buffer, int buffer_size, double value, int dec_digits);
</code></pre>
<p>The functions to convert double to text are <code>snprintf</code>, <code>fcvt_s</code>,<code>twr_dtoa</code>, <code>twr_wasm_toexponential</code>, and <code>twr_wasm_tofixed</code></p>
<h2 id="twr_dtoa">twr_dtoa</h2>
<pre><code>#include &quot;twr-crt.h&quot;

void twr_dtoa(char* buffer, int sizeInBytes, double value, int max_precision);
</code></pre>
<p>The functions to convert double to text are <code>snprintf</code>, <code>fcvt_s</code>,<code>twr_dtoa</code>, <code>twr_wasm_toexponential</code>, and <code>twr_wasm_tofixed</code></p>
<h2 id="twr_atod">twr_atod</h2>
<p>Similar to stdlib <code>atof</code>.</p>
<pre><code>#include &quot;twr-crt.h&quot;

double twr_atod(const char* str);
</code></pre>
<h2 id="twr_atou64">twr_atou64</h2>
<pre><code>#include &quot;twr-crt.h&quot;

int64_t twr_atou64(const char *str, int* len);
</code></pre>
<h2 id="floating-math-helpers">floating math helpers</h2>
<pre><code>
int twr_isnan(double v);
int twr_isinf(double v);
double twr_nanval();
double twr_infval();
</code></pre>
<h2 id="twr_cache_mallocfree">twr_cache_malloc/free</h2>
<p>These functions keep allocated memory in a cache for much faster access than the standard malloc/free.</p>
<pre><code>#include &quot;twr-crt.h&quot;

void *twr_cache_malloc(twr_size_t size);
void twr_cache_free(void* mem);
</code></pre>
<h2 id="twr_atosign">twr_atosign</h2>
<p>returns 1 or -1.  *len is updated next index (1) after sign (or zero if no sign char found).</p>
<pre><code>#include &quot;twr-crt.h&quot;

int twr_atosign(const char *str, int* len);
</code></pre>
<h2 id="twr_strhorizflip">twr_strhorizflip</h2>
<p>Mirror image the passed in string.</p>
<pre><code>#include &quot;twr-crt.h&quot;

void twr_strhorizflip(char * buffer, int n);
</code></pre>
<h2 id="twr_vprintf">twr_vprintf</h2>
<p>performs a printf by calling the callback with cbdata for each character.</p>
<pre><code>#include &quot;twr-crt.h&quot;

void twr_vprintf(twr_cbprintf_callback out, void* cbdata, const char *format, va_list* args);
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../api-typescript/" class="btn btn-neutral float-left" title="TypeScript/JavaScript"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../api-c-d2d/" class="btn btn-neutral float-right" title="C Draw 2D">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/twiddlingbits/tiny-wasm-runtime" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../api-typescript/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api-c-d2d/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
