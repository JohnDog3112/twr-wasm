<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://twiddlingbits.dev/api/api-localization/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>C Localization - twr-wasm documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "C Localization";
        var mkdocs_page_input_path = "api\\api-localization.md";
        var mkdocs_page_url = "/api/api-localization/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> twr-wasm documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/firstwasm/">Your First C Wasm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/keyconcepts/">Key Concepts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/stdio/">Stdio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/compiler-opts/">Compiler, Linker, Memory</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-helloworld/">hello world</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-div/">stdio-div</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-stdio-canvas/">stdio-canvas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-balls/">balls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-maze/">maze</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-fft/">fft</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/examples-more/">more</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api-typescript/">TypeScript/JavaScript</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">C Localization</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#character-encodings">Character encodings</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#locales">Locales</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#c">"C"</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#posix">"POSIX"</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_1">""</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#utf-8">".UTF-8"</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#1252">".1252"</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#others">Others</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#select-the-default-locale">Select the default locale</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#libc">libc++</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#c-functions">C functions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#posix-functions">POSIX functions</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-general/">C General</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-libc%2B%2B/">C++ libc++</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-d2d/">C Draw 2D</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-con/">C Console I/O</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-c-stdlib/">C Standard C Library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">More</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/wasm-problem/">The Wasm Problem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/production/">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../more/building/">Building the Source</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">twr-wasm documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
      <li class="breadcrumb-item active">C Localization</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/twiddlingbits/twr-wasm/tree/main/docs/api/api-localization.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="locale-support">Locale Support</h1>
<h2 id="character-encodings">Character encodings</h2>
<p>twr-wasm locales supports ASCII, UTF-8 or windows-1252 encoding.  UTF-16/32 are not supported as a locale setting, but functions are provided to convert utf-32 (unicode code points) to and from ASCII, UTF-8, and windows-1252 "code pages" (there are other miscellaneous utf-32 based functions as well.)</p>
<p>UTF-8 uses between one to four bytes to represent any unicode character, with ASCII compatibility in the first 128 bytes.  It is also the standard for the web, and the default for clang.   But because it uses a variable number of bytes per character it can make string manipulation in C a bit harder than ASCII.</p>
<p>Windows-1252 is the default on most Windows computers in many countries - particularly the Americas and western Europe.  It is an extension of ASCII that uses a single byte per character.  This makes it easier than UTF-8 from a programmers perspective, but it doesn't represent as many characters.   It is provided to make it easier to port legacy C code, windows code,  as well as a simpler alternative to UTF-8.</p>
<p>Although the locale settings don't support utf-32 directly, you can use int arrays (instead of byte arrays) to hold utf-32 strings, and then convert them to/from utf-8 with the help of the provided two functions for this purpose.  </p>
<h2 id="locales">Locales</h2>
<h3 id="c">"C"</h3>
<p>"C" is the default locale, as usual.  When "C" is selected, the functions operate as usual. One subtly is that console i/o functions (such as <code>printf</code>) will generally function as expected with UTF-8, since the <code>div</code> and <code>window</code> consoles correctly handle UTF-8 character encoding.  This is normal on some OSs, such as linux, but not the default on Windows (which often defaults to windows-1252 for backward compatibility).</p>
<p><code>isgraph</code> style functions will only recognize ASCII characters, as is normal.   Functions such as <code>strcmp</code> operate on the byte sequence, which will typically results in UTF-8 codes being compared lexically. <code>strcoll</code> will use lexical ordering.</p>
<h3 id="posix">"POSIX"</h3>
<p>"POSIX" is the same as "C"</p>
<h3 id="_1">""</h3>
<p>"" is the locale to specify the users default setting (this selects the setting used by the browser).  This will also enable UTF-8 in functions such as <code>strcoll</code>.  For example, if your browser is set to "en-US" as its default locale, <code>setlocale(LC_ALL, "")</code> will return <code>en-US.UTF-8</code>.  </p>
<p><code>isgraph</code> style functions will still only recognize ASCII characters (since UTF-8 doesn't encode any single bytes greater than 127).  <code>strcoll</code>  uses locale specific ordering, and <code>printf</code> will use locale specific decimal points.  <code>strcmp</code> still compares two strings lexicographically (byte-by-byte) without considering locale-specific rules, per the spec. </p>
<h3 id="utf-8">".UTF-8"</h3>
<p>".UTF-8" is the same as "" with twr-wasm.</p>
<h3 id="1252">".1252"</h3>
<p>".1252" will select the current default locale, but use windows-1252 character encoding (instead of UTF-8). Windows-1252 is a super set of ISO-8859-1 and is the most commonly used encoding for many european languages when unicode is not used.  This mode is primarily for legacy software, backwards compatibly, and windows compatibility.   </p>
<p><strong>1252 String Literals</strong></p>
<p>These days text editors generally default to UTF-8.  In order to use windows-1252  source code and/or string literals, such as <code>const char * str="€100"</code> you may need to: </p>
<ul>
<li>Configure your text editor to save in Windows-1252/ISO-8859-1 format (instead of UTF-8)</li>
<li>use compiler flags like <code>--finput-charset</code> and <code>-fexec-charset</code></li>
</ul>
<p>By default, the Microsoft Visual Studio C compiler (MSVC) does not treat string literals as UTF-8. Instead, it treats them as being encoded in the current code page of the system, which is typically Windows-1252 on western european language Windows systems.  twr-wasm is designed to work with clang, which does default to utf-8, so if you are compiling code written for MSVC, and you use extend character sets (non ASCII), you may need to adjust your compiler settings with the flags mentioned above.</p>
<h3 id="others">Others</h3>
<p>Setting arbitrary locales, such as "fr-FR" when the browser is defaulted to another locale, is not supported.  </p>
<h3 id="select-the-default-locale">Select the default locale</h3>
<p>To select the user's browser's default locale using the C language, and enable consistent utf-8 support, use a call like this:</p>
<pre><code>setlocale(LC_ALL, &quot;&quot;)
</code></pre>
<h2 id="libc">libc++</h2>
<p>If you are using C++, libc++ locale functions work as expected.</p>
<h2 id="c-functions">C functions</h2>
<p>The normal standard C library locale support is available, along with some POSIX extensions.   In addition, some locale useful twr-wasm specific functions are documented in <a href="../api-c-general/">C API</a>, such as <code>twr_get_current_locale</code>,<code>twr_mbgets</code>, <code>twr_getc32</code>, <code>twr_utf8_char_len</code>, <code>twr_mbslen_l</code>, <code>twr_utf32_to_code_page</code>, <code>twr_code_page_to_utf32_streamed</code>, <code>twr_get_navlang</code>, <code>twr_localize_numeric_string</code>.</p>
<p>Note that <code>io_getc32()</code>, <code>getc(stdin)</code>, <code>fgetc(stdin)</code> do not look at the current locale.  <code>iogetc32</code> returns a 32 bit unicode code point, and <code>getc</code>/<code>fgetc</code> return extended ASCII. </p>
<p>For a locale aware character input, use <code>io_mbgetc()</code> or <code>twr_mbgets()</code>. Both use the locale category LC_CTYPE.  See <a href="../api-c-general/">C API</a>.</p>
<p>Note that when the locale is not set (or whenever the "C" locale is set) functions that get character(s) from stdin that are locale aware, like <code>twr_mbgets()</code>, behave different than functions that output characters to stdout (like  <code>puts</code>, <code>io_putstr</code>, <code>io_putc</code>, <code>putchar</code>).  Characters to stdout in "C" locale will handle UTF-8 characters.  For stdin, "C" locale uses ASCII.</p>
<p>For consistent UTF-8 (or windows-1252) behavior, set the locale as discussed above ( use <code>setlocale</code> )</p>
<p>The primary standard C library locale functions are:</p>
<pre><code>char* setlocale(int category, const char* locale);
struct lconv *localeconv(void);
</code></pre>
<p>As well as the standard library functions above, appropriate functions take into account the current locale (printf, strcoll, etc).</p>
<p>Note that <code>setlocale</code> returns a string using BCP 47 format (similar to a web browser).  Locale strings look like "en-US.UTF-8", instead of "en_US.UTF-8".
A dash, not an underscore, is used as a separator.</p>
<h3 id="posix-functions">POSIX functions</h3>
<p>These are the extended POSIX style functions provided that are related to locale:</p>
<pre><code>locale_t newlocale(int category_mask, const char *locale, locale_t base);
locale_t uselocale(locale_t);
void freelocale(locale_t);
locale_t duplocale(locale_t);

int isalnum_l(int c, locale_t loc);
int isalpha_l(int c, locale_t loc);
int isblank_l(int c, locale_t loc);
int iscntrl_l(int c, locale_t loc);
int isdigit_l(int c, locale_t loc);
int isgraph_l(int c, locale_t loc);
int islower_l(int c, locale_t loc);
int isprint_l(int c, locale_t loc);
int ispunct_l(int c, locale_t loc);
int isspace_l(int c, locale_t loc);
int isupper_l(int c, locale_t loc);
int isxdigit_l(int c, locale_t loc);
int tolower_l(int c, locale_t loc);
int toupper_l(int c, locale_t loc);

long long strtoll_l(const char *str, char **str_end, int base,  locale_t loc);
unsigned long long strtoull_l(const char *str, char **str_end,  int base, locale_t loc);
float strtof_l(const char *str, char ** str_end, locale_t locale);
double strtod_l(const char *str, char **str_end, locale_t locale);
long double strtold_l(const char *str, char **str_end, locale_t locale);

int strcoll_l(const char* lhs, const char* rhs,  locale_t loc);

size_t strftime_l(char *s, size_t maxsize, const char *format, const struct tm *timeptr, locale_t locale);

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../api-typescript/" class="btn btn-neutral float-left" title="TypeScript/JavaScript"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../api-c-general/" class="btn btn-neutral float-right" title="C General">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/twiddlingbits/twr-wasm" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../api-typescript/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api-c-general/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
